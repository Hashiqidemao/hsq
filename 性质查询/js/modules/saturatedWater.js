export function init(container) {
  container.innerHTML = `
    <div class="module-container">
      <h2>饱和水性质查询</h2>

      <div class="form-row">
        <label>温度 (℃):
          <input type="number" id="tempInput" step="1">
        </label>
        <label>压力 (Pa):
          <input type="number" id="pressInput" step="1">
        </label>
      </div>

      <div class="form-actions">
        <button type="button" id="queryByTemp">温度查询</button>
        <button type="button" id="queryByPress">压力查询</button>
      </div>

      <table>
        <thead>
          <tr><th>参数</th><th>数值</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  `;

  const tempInput = container.querySelector('#tempInput');
  const pressInput = container.querySelector('#pressInput');
  const tbody = container.querySelector('tbody');

  const params = [
    "温度 (℃)", "压力 (Pa)", "密度 (kg/m³)",
    "焓 (kJ/kg)", "质量定压热容 (kJ/(kg·K))", "导热系数 (W/(m·K))",
    "热扩散系数 (m²/s)", "动力粘度 (Pa·s)", "运动粘度 (m²/s)", "普朗特数"
  ];

  const data = [
    [0, 0.00611e-5, 999.9, 0, 4.212, 0.551, 13.1e-6, 1788e-6, 1.789e-6, 13.67],
    [10, 0.01227e-5, 999.7, 42.04, 4.191, 0.574, 13.7e-6, 1306e-6, 1.306e-6, 9.52],
    [20, 0.02338e-5, 998.2, 83.91, 4.183, 0.599, 14.3e-6, 1004e-6, 1.006e-6, 5.42],
    [30, 0.04241e-5, 995.7, 125.7, 4.174, 0.618, 14.9e-6, 801.5e-6, 0.805e-6, 4.31],
    [40, 0.07375e-5, 992.2, 167.5, 4.174, 0.635, 15.3e-6, 653.3e-6, 0.659e-6, 3.54],
    [50, 0.12335e-5, 988.1, 209.3, 4.174, 0.648, 15.7e-6, 549.4e-6, 0.556e-6, 3.54],
    [60, 0.19920e-5, 983.2, 251.1, 4.179, 0.659, 16.0e-6, 469.9e-6, 0.478e-6, 2.98],
    [70, 0.3116e-5, 977.8, 293.0, 4.187, 0.668, 16.3e-6, 406.1e-6, 0.415e-6, 2.55],
    [80, 0.4736e-5, 971.8, 335.0, 4.195, 0.674, 16.6e-6, 355.1e-6, 0.365e-6, 2.21],
    [90, 0.7011e-5, 965.3, 377.0, 4.208, 0.680, 16.8e-6, 314.9e-6, 0.325e-6, 1.95],
    [100, 1.013e-5, 958.4, 419.1, 4.220, 0.683, 16.9e-6, 282.5e-6, 0.295e-6, 1.75],
    [110, 1.43e-5, 951.0, 461.4, 4.233, 0.685, 17.0e-6, 259.0e-6, 0.272e-6, 1.60],
    [120, 1.98e-5, 943.1, 503.7, 4.250, 0.686, 17.1e-6, 237.4e-6, 0.252e-6, 1.47],
    [130, 2.7e-5, 934.8, 546.4, 4.266, 0.686, 17.2e-6, 217.8e-6, 0.233e-6, 1.36],
    [140, 3.61e-5, 926.1, 589.1, 4.287, 0.685, 17.2e-6, 201.1e-6, 0.217e-6, 1.26],
    [150, 4.76e-5, 917.0, 632.2, 4.313, 0.684, 17.3e-6, 186.4e-6, 0.203e-6, 1.17],
    [160, 6.18e-5, 907.4, 675.4, 4.264, 0.683, 17.3e-6, 173.6e-6, 0.191e-6, 1.10],
    [170, 7.92e-5, 897.3, 719.3, 4.380, 0.679, 17.3e-6, 162.8e-6, 0.181e-6, 1.05],
    [180, 10.03e-5, 886.9, 763.3, 4.417, 0.674, 17.2e-6, 153.0e-6, 0.173e-6, 1.00],
    [190, 12.55e-5, 870.0, 807.8, 4.459, 0.670, 17.1e-6, 144.2e-6, 0.165e-6, 0.96],
    [200, 15.55e-5, 863.0, 852.5, 4.505, 0.663, 17.0e-6, 136.4e-6, 0.158e-6, 0.93],
    [210, 19.08e-5, 852.3, 897.7, 4.555, 0.655, 16.9e-6, 130.5e-6, 0.153e-6, 0.91],
    [220, 23.20e-5, 840.3, 943.7, 4.614, 0.645, 16.6e-6, 124.6e-6, 0.148e-6, 0.89],
    [230, 27.98e-5, 827.3, 990.2, 4.681, 0.637, 16.4e-6, 119.7e-6, 0.145e-6, 0.88],
    [240, 33.48e-5, 813.6, 1037.5, 4.756, 0.628, 16.2e-6, 114.8e-6, 0.141e-6, 0.87],
    [250, 39.78e-5, 799.0, 1085.7, 4.844, 0.618, 15.9e-6, 109.9e-6, 0.137e-6, 0.86],
    [260, 46.94e-5, 784.0, 1135.1, 4.949, 0.605, 15.6e-6, 105.9e-6, 0.135e-6, 0.87],
    [270, 55.05e-5, 767.9, 1185.3, 5.070, 0.590, 15.1e-6, 102.0e-6, 0.133e-6, 0.88],
    [280, 64.20e-5, 750.7, 1236.8, 5.230, 0.574, 14.6e-6, 98.1e-6, 0.131e-6, 0.90],
    [290, 74.46e-5, 732.3, 1290.0, 5.485, 0.558, 13.9e-6, 94.2e-6, 0.129e-6, 0.93],
    [300, 85.92e-5, 712.5, 1344.9, 5.736, 0.540, 13.2e-6, 91.2e-6, 0.128e-6, 0.97],
    [310, 98.70e-5, 691.1, 1402.2, 6.071, 0.523, 12.5e-6, 88.3e-6, 0.128e-6, 1.03]
  ];

  function interp(x, x1, x2, y1, y2) {
    return y1 + (x - x1) * (y2 - y1) / (x2 - x1);
  }

  function query(x, idx) {
    for (let i = 0; i < data.length - 1; i++) {
      const r1 = data[i], r2 = data[i + 1];
      if (r1[idx] <= x && x <= r2[idx]) {
        const res = data[i].map((_, j) => interp(x, r1[idx], r2[idx], r1[j], r2[j]));
        res[idx] = x;
        return res;
      }
    }
    return null;
  }

  function update(res) {
    tbody.innerHTML = params.map((p, i) =>
      `<tr><td>${p}</td><td>${res[i].toExponential(6)}</td></tr>`
    ).join('');
  }

  container.querySelector('#queryByTemp').onclick = () => {
    const t = parseFloat(tempInput.value);
    if (isNaN(t)) return alert('请输入有效温度');
    const r = query(t, 0);
    r ? update(r) : alert('温度超出范围');
  };

  container.querySelector('#queryByPress').onclick = () => {
    const p = parseFloat(pressInput.value);
    if (isNaN(p)) return alert('请输入有效压力');
    const r = query(p, 1);
    r ? update(r) : alert('压力超出范围');
  };
}
