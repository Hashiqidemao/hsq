// js/modules/dryAir.js
export function init(container) {
  container.innerHTML = `
    <div class="module-container">
      <h2>干空气热物理性质查询</h2>

      <div class="form-row">
        <label>温度 (℃):
          <input type="number" id="tempInput" step="1">
        </label>
      </div>

      <div class="form-actions">
        <button type="button" id="queryBtn">查询</button>
      </div>

      <table>
        <thead>
          <tr><th>参数</th><th>数值</th></tr>
        </thead>
        <tbody id="resultBody"></tbody>
      </table>
    </div>
  `;

  const input = container.querySelector('#tempInput');
  const btn   = container.querySelector('#queryBtn');
  const tbody = container.querySelector('#resultBody');

  const headers = [
    '密度 (kg/m³)', '定压热容 (kJ/(kg·K))', '导热系数 (W/(m·K))',
    '导温系数 (m²/s)', '动力粘度 (Pa·s)', '运动粘度 (m²/s)', '普朗特数'
  ];

  const data = [
    [-50, 1.584,1.013,2.034,1.27,1.46,9.23,0.728],
    [-40, 1.515,1.013,2.115,1.38,1.52,10.04,0.728],
    [-30, 1.453,1.013,2.196,1.49,1.57,10.80,0.723],
    [-20, 1.395,1.009,2.278,1.62,1.62,11.60,0.716],
    [-10, 1.342,1.009,2.359,1.74,1.67,12.43,0.712],
    [0,   1.293,1.005,2.440,1.88,1.72,13.28,0.707],
    [10,  1.247,1.005,2.510,2.01,1.77,14.16,0.705],
    [20,  1.205,1.005,2.581,2.14,1.81,15.06,0.703],
    [30,  1.165,1.005,2.673,2.29,1.86,16.00,0.701],
    [40,  1.128,1.005,2.754,2.43,1.91,16.96,0.699],
    [50,  1.093,1.005,2.824,2.57,1.96,17.95,0.698],
    [60,  1.060,1.005,2.893,2.72,2.01,18.97,0.696],
    [70,  1.029,1.009,2.963,2.86,2.06,20.02,0.694],
    [80,  1.000,1.009,3.004,3.02,2.11,21.09,0.692],
    [90,  0.972,1.009,3.126,3.19,2.15,22.10,0.690],
    [100, 0.946,1.009,3.207,3.36,2.19,23.13,0.688],
    [120, 0.898,1.009,3.335,3.68,2.29,25.45,0.686],
    [140, 0.854,1.013,3.486,4.03,2.37,27.80,0.684],
    [160, 0.815,1.017,3.637,4.39,2.45,30.09,0.682],
    [180, 0.779,1.022,3.777,4.75,2.53,32.49,0.681],
    [200, 0.746,1.026,3.928,5.14,2.60,34.85,0.680],
    [250, 0.674,1.038,4.625,6.10,2.74,40.61,0.677],
    [300, 0.615,1.047,4.602,7.16,2.97,48.33,0.674],
    [350, 0.566,1.059,4.904,8.19,3.14,55.46,0.676],
    [400, 0.524,1.068,5.206,9.31,3.31,63.09,0.678],
    [500, 0.456,1.093,5.740,11.53,3.62,79.38,0.687],
    [600, 0.404,1.114,6.217,13.83,3.91,96.89,0.699],
    [700, 0.362,1.135,6.700,16.34,4.018,115.4,0.706],
    [800, 0.329,1.156,7.170,18.88,4.43,134.8,0.713],
    [900, 0.301,1.172,7.623,21.82,4.67,155.1,0.717],
    [1000,0.277,1.185,8.064,24.59,4.90,177.1,0.719],
    [1100,0.257,1.197,8.494,27.63,5.12,199.3,0.722],
    [1200,0.239,1.210,9.145,31.65,5.35,233.7,0.724],
  ];

  function interp(x, xArr, yArr) {
    for (let i = 0; i < xArr.length - 1; i++) {
      if (xArr[i] <= x && x <= xArr[i + 1]) {
        const x0 = xArr[i], x1 = xArr[i + 1];
        const y0 = yArr[i], y1 = yArr[i + 1];
        return y0 + (x - x0) * (y1 - y0) / (x1 - x0);
      }
    }
    return null;
  }

  btn.addEventListener('click', () => {
    const t = parseFloat(input.value);
    if (isNaN(t)) return alert('请输入有效温度');

    const temps = data.map(r => r[0]);
    const results = headers.map((_, i) => {
      const col = data.map(r => r[i + 1]);
      const v = interp(t, temps, col);
      return v == null ? null : v.toFixed(4);
    });
    if (results.some(r => r == null)) return alert('超出温度范围');

    tbody.innerHTML = headers.map((h, i) =>
      `<tr><td>${h}</td><td>${results[i]}</td></tr>`
    ).join('');
  });
}
